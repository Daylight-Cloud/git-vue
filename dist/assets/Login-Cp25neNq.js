import{_ as M,r as m,u as B,o as R,a as D,c as I,b as N,d as r,e as o,w as t,f as j,g as l,h as q,E as v,i as z,j as E,k as K,l as T,m as w}from"./index-C2iAr7MH.js";const A="/login-bg.jpg",P={class:"login-root"},F={class:"glass-card"},G={class:"foot"},H={__name:"Login",setup(J){const b=z(),n=m({username:"",password:""}),L={username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},k=m(null),f=m(!1),V=m(!1),c=m(localStorage.getItem("dark")==="1"?!0:window.matchMedia("(prefers-color-scheme: dark)").matches),y=()=>{document.documentElement.classList.toggle("dark",c.value),localStorage.setItem("dark",c.value?"1":"0")},S=B(),h=async()=>{var e,u,d;if(await((e=k.value)==null?void 0:e.validate().catch(()=>!1))){f.value=!0;try{const{data:s}=await q.post("http://101.42.169.71:3000/login",n.value),{token:i,user:_}=s||{};if(!i){v.error("Token 获取失败");return}S.setAuth(i,_),v.success("登录成功");const g=_.role==="admin"?"/admin/dashboard":"/user/home";b.push(g)}catch(s){console.error("Login Error:",s),v.error(((d=(u=s.response)==null?void 0:u.data)==null?void 0:d.error)||"登录失败")}finally{f.value=!1}}},U=()=>b.push("/register"),x=p=>{p.key==="Enter"&&(p.stopPropagation(),h())};return R(()=>{y(),window.addEventListener("keydown",x)}),D(()=>{window.removeEventListener("keydown",x)}),(p,e)=>{const u=l("el-icon"),d=l("el-input"),s=l("el-form-item"),i=l("el-button"),_=l("el-form"),g=l("el-checkbox"),C=l("el-switch");return N(),I("div",P,[e[8]||(e[8]=r("img",{class:"bg-img",src:A,alt:"bg"},null,-1)),r("div",F,[e[7]||(e[7]=r("div",{class:"brand"},[r("h1",null,"图书管理系统"),r("p",null,"Knowledge Changes Destiny")],-1)),o(_,{model:n.value,rules:L,ref_key:"formRef",ref:k,onSubmit:j(h,["prevent"])},{default:t(()=>[o(s,{prop:"username"},{default:t(()=>[o(d,{modelValue:n.value.username,"onUpdate:modelValue":e[0]||(e[0]=a=>n.value.username=a),size:"large",placeholder:"用户名",clearable:""},{prefix:t(()=>[o(u,{class:"input-icon"},{default:t(()=>[o(E(K))]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(s,{prop:"password"},{default:t(()=>[o(d,{modelValue:n.value.password,"onUpdate:modelValue":e[1]||(e[1]=a=>n.value.password=a),size:"large",type:"password",placeholder:"密码","show-password":"",clearable:""},{prefix:t(()=>[o(u,{class:"input-icon"},{default:t(()=>[o(E(T))]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(s,null,{default:t(()=>[o(i,{"native-type":"submit",class:"submit-btn",loading:f.value},{default:t(()=>e[4]||(e[4]=[w(" 登录 ")])),_:1,__:[4]},8,["loading"])]),_:1})]),_:1},8,["model"]),r("div",G,[o(g,{modelValue:V.value,"onUpdate:modelValue":e[2]||(e[2]=a=>V.value=a)},{default:t(()=>e[5]||(e[5]=[w("记住我")])),_:1,__:[5]},8,["modelValue"]),o(i,{type:"text",onClick:U},{default:t(()=>e[6]||(e[6]=[w("立即注册")])),_:1,__:[6]})])]),o(C,{modelValue:c.value,"onUpdate:modelValue":e[3]||(e[3]=a=>c.value=a),class:"dark-switch","inline-prompt":"","active-icon":"Moon","inactive-icon":"Sunny",onChange:y},null,8,["modelValue"])])}}},Q=M(H,[["__scopeId","data-v-3b14b8d2"]]);export{Q as default};
