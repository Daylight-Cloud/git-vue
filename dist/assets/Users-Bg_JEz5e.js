import{_ as q,r as d,v as G,o as H,c as J,b as K,d as i,e as l,w as o,s as f,g as r,m,t as C}from"./index-C2iAr7MH.js";const O={class:"users-root"},Q={class:"user-cell"},W={class:"name"},X={class:"account"},Y={class:"pagination"},Z={class:"avatar-field"},ee={class:"avatar-preview"},x=8,ae={__name:"Users",setup(le){const g=d([]),v=d(!1),_=d(!1),V=d(null),A=d(null),s=d({username:"",role:"user",email:"",avatar_data:"",avatar_preview:""}),w=d(1),B=G(()=>{const a=(w.value-1)*x;return g.value.slice(a,a+x)}),h=(a="user")=>{const e=["#FF6B6B","#4ECDC4","#45B7D1","#FFA07A","#98D8C8","#F7DC6F","#BB8FCE","#85C1E2"],u=(a||"u").charCodeAt(0)%e.length,n=e[u],c=(a||"U").charAt(0).toUpperCase(),y=`<svg width="60" height="60" xmlns="http://www.w3.org/2000/svg"><circle cx="30" cy="30" r="30" fill="${n}"/><text x="30" y="35" font-size="24" fill="white" font-family="Arial" font-weight="bold" text-anchor="middle">${c}</text></svg>`;return"data:image/svg+xml;base64,"+btoa(y)},b=async()=>{const a=await f.get("/users");g.value=Array.isArray(a)?a:[]},D=()=>{s.value={username:"",role:"user",email:"",avatar_data:"",avatar_preview:""}},F=()=>{_.value=!1,D(),v.value=!0},z=a=>{_.value=!0,V.value=a.id,s.value={username:a.username,role:a.role,email:a.email||"",avatar_data:"",avatar_preview:a.avatar||""},v.value=!0},$=a=>new Promise((e,u)=>{const n=new FileReader;n.onload=()=>e(n.result),n.onerror=u,n.readAsDataURL(a)}),E=async a=>{if(!a||!a.raw)return;const e=await $(a.raw);s.value.avatar_preview=e,s.value.avatar_data=e},R=async()=>{const a={username:s.value.username,role:s.value.role,email:s.value.email,avatar:s.value.avatar_data||s.value.avatar_preview};_.value?await f.put(`/users/${V.value}`,a):await f.post("/users",a),v.value=!1,b()},I=async a=>{await f.delete(`/users/${a}`),b()};H(b);const N=a=>{w.value=a};return(a,e)=>{const u=r("el-button"),n=r("el-table-column"),c=r("el-avatar"),y=r("el-table"),P=r("el-pagination"),U=r("el-input"),p=r("el-form-item"),k=r("el-option"),S=r("el-select"),L=r("el-upload"),M=r("el-form"),T=r("el-dialog");return K(),J("div",O,[e[11]||(e[11]=i("h1",{class:"users-title"},"用户管理",-1)),l(u,{type:"primary",onClick:F,style:{"margin-bottom":"16px"}},{default:o(()=>e[5]||(e[5]=[m("新增用户")])),_:1,__:[5]}),l(y,{data:B.value,style:{width:"100%","border-radius":"12px"}},{default:o(()=>[l(n,{type:"index",label:"序号",width:"60"}),l(n,{label:"用户","min-width":"240"},{default:o(({row:t})=>[i("div",Q,[l(c,{size:38,src:t.avatar||h(t.username)},null,8,["src"]),i("div",null,[i("div",W,C(t.nickname||t.username),1),i("small",X,"@"+C(t.username),1)])])]),_:1}),l(n,{prop:"email",label:"邮箱","min-width":"220"},{default:o(({row:t})=>[m(C(t.email||"—"),1)]),_:1}),l(n,{prop:"role",label:"角色",width:"120"}),l(n,{label:"操作",width:"180"},{default:o(t=>[l(u,{size:"small",onClick:j=>z(t.row)},{default:o(()=>e[6]||(e[6]=[m("编辑")])),_:2,__:[6]},1032,["onClick"]),l(u,{size:"small",type:"danger",onClick:j=>I(t.row.id)},{default:o(()=>e[7]||(e[7]=[m("删除")])),_:2,__:[7]},1032,["onClick"])]),_:1})]),_:1},8,["data"]),i("div",Y,[l(P,{layout:"prev, pager, next","current-page":w.value,"page-size":x,total:g.value.length,onCurrentChange:N},null,8,["current-page","total"])]),l(T,{modelValue:v.value,"onUpdate:modelValue":e[4]||(e[4]=t=>v.value=t),title:_.value?"编辑用户":"新增用户",width:"460px"},{footer:o(()=>[l(u,{onClick:e[3]||(e[3]=t=>v.value=!1)},{default:o(()=>e[9]||(e[9]=[m("取消")])),_:1,__:[9]}),l(u,{type:"primary",onClick:R},{default:o(()=>e[10]||(e[10]=[m("确定")])),_:1,__:[10]})]),default:o(()=>[l(M,{model:s.value,ref_key:"formRef",ref:A,"label-width":"100px"},{default:o(()=>[l(p,{label:"用户名",prop:"username"},{default:o(()=>[l(U,{modelValue:s.value.username,"onUpdate:modelValue":e[0]||(e[0]=t=>s.value.username=t),autocomplete:"off"},null,8,["modelValue"])]),_:1}),l(p,{label:"角色",prop:"role"},{default:o(()=>[l(S,{modelValue:s.value.role,"onUpdate:modelValue":e[1]||(e[1]=t=>s.value.role=t),placeholder:"请选择"},{default:o(()=>[l(k,{label:"管理员",value:"admin"}),l(k,{label:"普通用户",value:"user"})]),_:1},8,["modelValue"])]),_:1}),l(p,{label:"邮箱"},{default:o(()=>[l(U,{modelValue:s.value.email,"onUpdate:modelValue":e[2]||(e[2]=t=>s.value.email=t),placeholder:"user@example.com"},null,8,["modelValue"])]),_:1}),l(p,{label:"头像"},{default:o(()=>[i("div",Z,[l(L,{"auto-upload":!1,"show-file-list":!1,accept:"image/*",onChange:E},{default:o(()=>[l(u,{type:"primary"},{default:o(()=>e[8]||(e[8]=[m("选择头像")])),_:1,__:[8]})]),_:1}),i("div",ee,[l(c,{size:60,src:s.value.avatar_preview||h(s.value.username)},null,8,["src"])])])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},oe=q(ae,[["__scopeId","data-v-def0783f"]]);export{oe as default};
