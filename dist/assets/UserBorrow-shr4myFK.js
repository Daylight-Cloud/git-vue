import{_ as N,r as w,o as D,c as C,b as I,d as s,e as r,w as a,s as f,g as n,m as c,t as d,p as h,q as Z,E as B}from"./index-C2iAr7MH.js";const $={class:"user-borrow"},H={class:"borrow-head"},P={class:"book-cell"},Q={class:"book-name"},R={class:"book-date"},S="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDgiIGhlaWdodD0iNjQiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGc+PHJlY3Qgd2lkdGg9IjQ4IiBoZWlnaHQ9IjY0IiByeD0iOCIgc3R5bGU9ImZpbGw6I0VFRjJGRiIgLz48cGF0aCBkPSJNMCAyMCBMIDQ4IDIwIEwgNDggNDQiIHN0eWxlPSJmaWxsOiNDREU0RkYiIC8+PHRleHQgeD0iMjQiIHk9IjM3IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBzdHlsZT0iZmlsbDojOTRBO0ZvbnQtd2VpZ2h0OmJvbGQ7Zm9udC1mYW1pbHk6QXJpYWw7Zm9udC1zaXplOjEycHgiPk5PIENPVkVSPC90ZXh0PjwvZz48L3N2Zz4=",j={__name:"UserBorrow",setup(G){const u=w([]),_=w(null),g=async()=>{try{const e=await f.get("/my/borrow");u.value=Array.isArray(e)?e:[]}catch(e){console.error("获取借阅记录失败:",e),u.value=[]}},y=e=>{if(!e||e==="null"||e==="NULL"||e===null)return"—";let t;if(typeof e=="string"&&e.includes(" ")?t=new Date(e.replace(/-/g,"/")):t=new Date(e),Number.isNaN(t.getTime()))return console.warn("无效的日期值:",e),"—";const i=t.getFullYear(),m=`${t.getMonth()+1}`.padStart(2,"0"),l=`${t.getDate()}`.padStart(2,"0"),p=`${t.getHours()}`.padStart(2,"0"),b=`${t.getMinutes()}`.padStart(2,"0"),o=`${t.getSeconds()}`.padStart(2,"0");return`${i}年${m}月${l}日 ${p}:${b}:${o}`},v=async e=>{_.value=e;try{await f.put(`/my/borrow/${e}/return`),B.success("已归还"),g()}finally{_.value=null}};D(g);const k=e=>e||S;return(e,t)=>{const i=n("el-button"),m=n("el-image"),l=n("el-table-column"),p=n("el-tag"),b=n("el-table");return I(),C("div",$,[s("div",H,[t[2]||(t[2]=s("div",null,[s("h1",null,"我的借阅"),s("p",null,"跟踪借阅进度，记录每一次相遇")],-1)),r(i,{type:"primary",onClick:t[0]||(t[0]=o=>e.$router.push("/user/library"))},{default:a(()=>t[1]||(t[1]=[c("去借书")])),_:1,__:[1]})]),r(b,{data:u.value,class:"borrow-table",stripe:""},{default:a(()=>[r(l,{label:"图书","min-width":"220"},{default:a(({row:o})=>[s("div",P,[r(m,{src:k(o.cover_url),fit:"cover",class:"cover-mini"},{error:a(()=>t[3]||(t[3]=[s("div",{class:"cover-mini empty"},"No Cover",-1)])),_:2},1032,["src"]),s("div",null,[s("div",Q,d(o.book_title),1),s("small",R,"借出时间："+d(y(o.borrow_date)),1)])])]),_:1}),r(l,{label:"归还时间","min-width":"200"},{default:a(({row:o})=>[c(d(o.return_date?y(o.return_date):"—"),1)]),_:1}),r(l,{label:"状态",width:"120"},{default:a(({row:o})=>[r(p,{type:o.status==="borrowed"?"warning":"success"},{default:a(()=>[c(d(o.status==="borrowed"?"借出中":"已归还"),1)]),_:2},1032,["type"])]),_:1}),r(l,{label:"操作",width:"160",fixed:"right"},{default:a(({row:o})=>[o.status==="borrowed"?(I(),h(i,{key:0,size:"small",type:"success",loading:_.value===o.id,onClick:M=>v(o.id)},{default:a(()=>t[4]||(t[4]=[c(" 归还 ")])),_:2,__:[4]},1032,["loading","onClick"])):Z("",!0)]),_:1})]),_:1},8,["data"])])}}},E=N(j,[["__scopeId","data-v-5cc5c6ed"]]);export{E as default};
