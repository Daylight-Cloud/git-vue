import{_ as q,u as N,A as x,r as C,o as z,c as I,b as L,d,e as o,w as s,t as h,g as m,m as p,s as k,E as P}from"./index-BjpkzZGY.js";const M={class:"profile"},$={class:"profile-card"},T={class:"avatar-wrap"},j={class:"avatar-actions"},G={class:"info"},H={class:"profile-form"},J={class:"profile-form"},K={__name:"UserProfile",setup(O){const f=N(),t=x({username:"",nickname:"",avatar:"",avatar_data:"",email:"",phone:""}),w=C(!1),r=x({currentPassword:"",newPassword:"",confirmPassword:""}),y=C(null),V=a=>{const e=["#FF6B6B","#4ECDC4","#45B7D1","#FFA07A","#98D8C8","#F7DC6F","#BB8FCE","#85C1E2"],i=(a||"").charCodeAt(0)%e.length,l=e[i],g=(a||"U").charAt(0).toUpperCase(),v=`<svg width="100" height="100" xmlns="http://www.w3.org/2000/svg"><rect width="100" height="100" fill="${l}"/><text x="50" y="50" font-family="Arial" font-size="40" fill="white" text-anchor="middle" dominant-baseline="central" font-weight="bold">${g}</text></svg>`;return"data:image/svg+xml;base64,"+btoa(v)},_=a=>{a&&(t.username=a.username,t.nickname=a.nickname,t.avatar=a.avatar||V(a.username),t.avatar_data="",t.email=a.email,t.phone=a.phone)},U=async()=>{const a=await f.fetchProfile();_(a)},A=()=>{const a=V(Date.now().toString());t.avatar=a},F=a=>new Promise((e,i)=>{const l=new FileReader;l.onload=()=>e(l.result),l.onerror=i,l.readAsDataURL(a)}),B=async a=>{if(!a||!a.raw)return;const e=await F(a.raw);t.avatar=e},D=async()=>{w.value=!0;try{await k.put("/me",{avatar:t.avatar,nickname:t.nickname,email:t.email,phone:t.phone}),await f.fetchProfile(),P.success("资料已更新")}finally{w.value=!1}},E=()=>{f.profile&&_(f.profile)},R={currentPassword:[{required:!0,message:"请输入当前密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码至少 6 位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入新密码",trigger:"blur"},{validator:(a,e,i)=>{e!==r.newPassword?i(new Error("两次输入的密码不一致")):i()},trigger:"blur"}]},S=()=>{y.value.validate(async a=>{if(a)try{await k.put("/me/password",{currentPassword:r.currentPassword,newPassword:r.newPassword}),P.success("密码已更新"),r.currentPassword="",r.newPassword="",r.confirmPassword=""}catch(e){P.error(e||"修改密码失败")}})};return z(async()=>{f.profile?_(f.profile):await U()}),(a,e)=>{const i=m("el-avatar"),l=m("el-button"),g=m("el-upload"),v=m("el-tag"),c=m("el-input"),u=m("el-form-item"),b=m("el-form");return L(),I("div",M,[d("section",$,[d("div",T,[o(i,{size:100,src:t.avatar},null,8,["src"]),d("div",j,[o(g,{"auto-upload":!1,"show-file-list":!1,accept:"image/*",onChange:B},{default:s(()=>[o(l,null,{default:s(()=>e[6]||(e[6]=[p("本地上传")])),_:1,__:[6]})]),_:1}),o(l,{text:"",type:"primary",onClick:A},{default:s(()=>e[7]||(e[7]=[p("使用系统头像")])),_:1,__:[7]})])]),d("div",G,[d("h2",null,h(t.nickname||t.username),1),d("p",null,"@"+h(t.username),1),o(v,{type:"info"},{default:s(()=>e[8]||(e[8]=[p("普通用户")])),_:1,__:[8]})])]),d("section",H,[e[11]||(e[11]=d("h3",null,"基本资料",-1)),o(b,{model:t,"label-width":"90px"},{default:s(()=>[o(u,{label:"昵称"},{default:s(()=>[o(c,{modelValue:t.nickname,"onUpdate:modelValue":e[0]||(e[0]=n=>t.nickname=n)},null,8,["modelValue"])]),_:1}),o(u,{label:"邮箱"},{default:s(()=>[o(c,{modelValue:t.email,"onUpdate:modelValue":e[1]||(e[1]=n=>t.email=n),placeholder:"name@example.com"},null,8,["modelValue"])]),_:1}),o(u,{label:"手机"},{default:s(()=>[o(c,{modelValue:t.phone,"onUpdate:modelValue":e[2]||(e[2]=n=>t.phone=n),placeholder:"137****"},null,8,["modelValue"])]),_:1}),o(u,null,{default:s(()=>[o(l,{type:"primary",loading:w.value,onClick:D},{default:s(()=>e[9]||(e[9]=[p("保存")])),_:1,__:[9]},8,["loading"]),o(l,{onClick:E},{default:s(()=>e[10]||(e[10]=[p("重置")])),_:1,__:[10]})]),_:1})]),_:1},8,["model"])]),d("section",J,[e[13]||(e[13]=d("h3",null,"密码管理",-1)),o(b,{model:r,rules:R,ref_key:"passwordRef",ref:y,"label-width":"90px"},{default:s(()=>[o(u,{label:"当前密码",prop:"currentPassword"},{default:s(()=>[o(c,{modelValue:r.currentPassword,"onUpdate:modelValue":e[3]||(e[3]=n=>r.currentPassword=n),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1}),o(u,{label:"新密码",prop:"newPassword"},{default:s(()=>[o(c,{modelValue:r.newPassword,"onUpdate:modelValue":e[4]||(e[4]=n=>r.newPassword=n),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1}),o(u,{label:"确认密码",prop:"confirmPassword"},{default:s(()=>[o(c,{modelValue:r.confirmPassword,"onUpdate:modelValue":e[5]||(e[5]=n=>r.confirmPassword=n),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1}),o(u,null,{default:s(()=>[o(l,{type:"primary",onClick:S},{default:s(()=>e[12]||(e[12]=[p("修改密码")])),_:1,__:[12]})]),_:1})]),_:1},8,["model"])])])}}},W=q(K,[["__scopeId","data-v-22eff469"]]);export{W as default};
